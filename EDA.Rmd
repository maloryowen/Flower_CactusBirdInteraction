---
title: "EDA"
output: html_document
---

Here, we will explore the data collected during the Spring 2019 flowering field season at the Granite Mountains desert research center. 

Some key datasets:
+ Bird visitation at focal cactus: the number of bird visitations to a focal cactus individual, with manipulated showiness of flowers (both real and fake) on a cactus at zero, fifteen, and thirty flowers per cactus. 
+ Cactus allocation: a measurement of reproductive and non reproductive structures of 100 cactus indivduals. This dataset will be paired with data on fruit production of the same individuals.
+ Line transects: site-wide measurements of bird diversity, mesohabitats, and behaviors
+ Cactus architecture temperature: records of micro-habitat temperature related to cacti by measuring the top of the cactus's canopy, within the cactus's canopy, and the cactus's understory.
+ Interspecific allocation of cacti: haphazardly collected data on the reproductive output as well as size of three cactus species (*Opuntia basilaris*, *Cylindropuntia echinocarpa*, and *Cylindropuntia acanthocarpa*)

```{r libraries, include=FALSE}
library(ggplot2)
library(dplyr)
library(kableExtra)
library(ggpubr)
library(tidyverse)
library(reshape)
library(reshape2)
```

```{r datasets, include=FALSE}
#bring in datasets of interest
site <- read.csv("~/Masters/Flower_CactusBirdInteractionR/data/line_transects/line_transects.csv")
head(site)

```

###Site Wide Exploration 
```{r Site Wide Vis}
#summary stats
unique(site$species)
#41 unique species
unique(site$behavior)
#14 unique behaviors
unique(site$mesohabitat)
#10 unique mesohabitats


#histogram of bird behaviors
behav <- ggplot(site, aes(x=behavior)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))
#lump into smaller groups 
bbehav <- ggplot(site, aes(x=broad_behavior)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust =1))

#histogram of bird mesohabitats
meso <- ggplot(site, aes(x=mesohabitat)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))

#histogram of bird species
species <- ggplot(site, aes(x=species)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))
#lump into broader taxa and functional groups
order <- ggplot(site, aes(x=order)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))
family <- ggplot(site, aes(x=family)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))

#histogram of bird distance from transect
dist <- ggplot(site, aes(x=distance)) + geom_bar() 


#make dataset to analyze that includes only visuals
site_visuals <- na.omit(site)
head(site_visuals)

#summary stats
unique(site_visuals$species)
#41 unique species
unique(site_visuals$behavior)
#14 unique behaviors
unique(site_visuals$mesohabitat)
#10 unique mesohabitats
#counts are the same for visuals versus no visuals

#histogram of bird behaviors
behavv <- ggplot(site_visuals, aes(x=behavior)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))
#lump into smaller groups 
bbehavv <- ggplot(site_visuals, aes(x=broad_behavior)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust =1))

#histogram of bird mesohabitats
mesov <- ggplot(site_visuals, aes(x=mesohabitat)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))

#histogram of bird species
speciesv <- ggplot(site_visuals, aes(x=species)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))
#lump into broader taxa and functional groups
orderv <- ggplot(site_visuals, aes(x=order)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))
familyv <- ggplot(site_visuals, aes(x=family)) + geom_bar() + theme(axis.text.x = element_text(angle = 60, hjust = 1))

#histogram of bird distance from transect
distv <- ggplot(site_visuals, aes(x=distance)) + geom_bar() 

#put together on one plot for side-by-side comparison

#taxanomic grid
tax <- ggarrange(species, speciesv, family, familyv, order, orderv,
                    labels = c("All", "Visuals", "All", "Visuals", "All", "Visuals"),
                    ncol = 2, nrow = 3)
tax

#behavior grid
bhv <- ggarrange(behav, behavv, bbehav, bbehavv,
                   labels = c("All","Visuals", "All", "Visuals"),
                   ncol = 2, nrow = 2)
bhv

#mesohabitat grid
mesohabitat <- ggarrange(meso, mesov,
                         labels = c("All", "Visuals"),
                         ncol = 1, nrow =2)
mesohabitat

#distance grid
distance <- ggarrange(dist, distv,
                      labels = c("A", "Visuals"),
                      ncol = 1, nrow =2)
distance


```

```{r Site Wide Stats}
#Behavior stats: which behaviors are most common?

#get counts for each behavior daily
daily.behav <- (data.frame(table(site$behavior, site$date, site$walk)))

shapiro.test(daily.behav$Freq)
#it's normally distributed

#run ANOVA 
dba <- aov(Freq ~ Var1, daily.behav)
summary(dba)
#p-value < 2e-16, very significant (as expected)
#Now see what stood out and in what direction
tuk1 <- TukeyHSD(dba, "Var1", ordered = TRUE)
tuktab1 <- data.frame(tuk1$Var1)
tuktab1 <- tuktab1 %>% rownames_to_column("behavior") 
tuktab1 <- transform(tuktab1, behavior = colsplit(behavior, split = "\\-", names = c('a', 'b'))) 
tuktab1$diff <- NULL 
tuktab1$lwr <- NULL 
tuktab1$upr<- NULL
names(tuktab1) <- c("behav1", "behav2")
tuktab1 <- mutate(tuktab1, behav2 = "")
separate(tuktab1, behavior, into = behav2, remove=TRUE)

#Very complicated, need a way to summarize results
acast(tuktab1, behavior.a ~ behavior.b , value.var='p.adj', 
      fun.aggregate=sum, margins=TRUE)

```

